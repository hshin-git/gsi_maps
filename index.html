<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>GSI Maps</title>

<link rel="stylesheet" href="dist/leaflet.css" />
<link rel="icon" type="image/png" href="./favicon/icon-192x192.png">
<link rel="apple-touch-icon" type="image/png" href="./favicon/apple-touch-icon-180x180.png">

<style type="text/css">
html,body { width: 99%; height: 95%; }
button { border-style: solid; font-weight: bold; width: 100px; border-radius: 8px; background-color: gold; }
#mapContainer { width: 100%; height: 100%; }
</style>

<script src="dist/leaflet.js"></script>
<script>
////////// SCRIPT BEGIN
// ベース地図の定義
const baseTiles = {
  "GSI:白地図": L.tileLayer('http://cyberjapandata.gsi.go.jp/xyz/blank/{z}/{x}/{y}.png'),
  "GSI:淡色地図": L.tileLayer('http://cyberjapandata.gsi.go.jp/xyz/pale/{z}/{x}/{y}.png'),
  "GSI:標準地図": L.tileLayer('https://cyberjapandata.gsi.go.jp/xyz/std/{z}/{x}/{y}.png'),
//"GSI:英語地図": L.tileLayer('https://cyberjapandata.gsi.go.jp/xyz/english/{z}/{x}/{y}.png'),
  "OSM:標準地図": L.tileLayer('http://tile.openstreetmap.jp/{z}/{x}/{y}.png'),
};
// レイヤ地図の定義
const OPACITY = 0.8;
const overTiles = {
  "GSI:色別標高図": L.tileLayer('http://cyberjapandata.gsi.go.jp/xyz/relief/{z}/{x}/{y}.png',{opacity:OPACITY}),
  "GSI:陰影起伏図": L.tileLayer('http://cyberjapandata.gsi.go.jp/xyz/hillshademap/{z}/{x}/{y}.png',{opacity:OPACITY}),
  "GSI:赤色立体図": L.tileLayer('https://cyberjapandata.gsi.go.jp/xyz/sekishoku/{z}/{x}/{y}.png',{opacity:OPACITY}),
  "GSI:傾斜量図": L.tileLayer('http://cyberjapandata.gsi.go.jp/xyz/slopemap/{z}/{x}/{y}.png',{opacity:OPACITY}),
  "GSI:航空写真": L.tileLayer('https://cyberjapandata.gsi.go.jp/xyz/seamlessphoto/{z}/{x}/{y}.jpg',{opacity:OPACITY}),
  "GSI:活断層図": L.tileLayer('https://cyberjapandata.gsi.go.jp/xyz/afm/{z}/{x}/{y}.png',{opacity:OPACITY}),
  "GSI:低湿地": L.tileLayer('https://cyberjapandata.gsi.go.jp/xyz/swale/{z}/{x}/{y}.png',{opacity:OPACITY}),
};
// 地図の初期化
const homeLat =  35.4685;
const homeLon = 139.6297;
var thisMap = null;
function _onLoad() {
  thisMap = L.map('mapContainer',{zoomControl:false});
  thisMap.setView([homeLat, homeLon], 12);
  L.control.scale({maxWidth:200,position:'bottomright',imperial:false}).addTo(thisMap);
  L.control.zoom({position:'bottomleft'}).addTo(thisMap);
  // 地図の登録
  L.control.layers(baseTiles,overTiles).addTo(thisMap);
  baseTiles["GSI:白地図"].addTo(thisMap);
};
// 現在地の取得
var hereMarker = null;
var hereLat = homeLat;
var hereLon = homeLon; 
function getLatLon() {
  if (navigator.geolocation) {
    var setLatLon = function (position) {
      hereLat = position.coords.latitude;
      hereLon = position.coords.longitude;
    };
    navigator.geolocation.getCurrentPosition(setLatLon);
  };
};
function _imaKoko() {
  const now = new Date();
  const nowStr = ("0"+now.getHours()).slice(-2) +"時"+ ("0"+now.getMinutes()).slice(-2) +"分"+ ("0"+now.getSeconds()).slice(-2) +"秒";
  getLatLon();
  if (hereMarker) { thisMap.removeLayer(hereMarker); };
  hereMarker = L.marker([hereLat, hereLon]);
  hereMarker.bindPopup(nowStr);
  hereMarker.addTo(thisMap);
  hereMap.setView([hereLat, hereLon]);
};
////////// SCRIPT END
</script>
</head>

<body onload="_onLoad()">
<center><button id="imakoko" onClick="_imaKoko()">現在位置</button></center>
<div id="mapContainer"></div>
</body>

</html>
